"0","# Parameters"
"0","S0 <- 100      # Initial stock price"
"0","mu <- 0.05     # Drift"
"0","sigma <- 0.2   # Volatility"
"0","Time <- 1         # Time horizon (years)"
"0","n <- 252       # Number of time steps"
"0","M <- 100      # Number of simulated paths"
"0","r <- 0.03      # Risk-free rate"
"0",""
"0","# Simulate paths using sde.sim"
"0","S_paths <- sde.sim(X0 = S0, model = ""BS"", theta =c(mu, sigma), T = Time, N = n, M = M)"
"0",""
"0","# Compute expectation under risk-neutral measure"
"0","E_S_N1 <- apply(S_paths, 1, mean)  # Mean of exponentiated paths at each time step"
"0",""
"0","# Apply Mean-Correcting Martingale (MCM) formula"
"0","S_RN_MCM <- S0 * S_paths * exp(r * (1:N) * (Time/N)) / E_S_N1"
"0",""
"0","grid.arrange(top = paste(""Simulated Stock Price Paths before and after MCM\n Showing"", min(30, M), ""simulations""), ncol =2, "
"0","quickplot(S_paths[,1:min(30, M)], show_legend = F, title = ""BEFORE""),"
"0","quickplot(S_RN_MCM[,1:min(30, M)], show_legend = F, title = "" AFTER"", ylab = NULL))"
